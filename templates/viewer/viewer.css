:root {
  --bg: #111;
  --fg: #e8e8e8;
  --muted: #aaa;
  --accent: #8cc665;
  --rule: #2a2a2a;
  --content-width: 48rem;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0; padding: 0;
  background: var(--bg); color: var(--fg);
  font: 16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
}

.toolbar {
  position: sticky; top: 0; z-index: 1000;
  display: flex; flex-wrap: wrap; gap: .75rem; align-items: center;
  padding: .6rem .9rem; background: #0c0c0c; border-bottom: 1px solid var(--rule);
}
.controls { display: flex; gap: .5rem; align-items: center; }
.toggles { margin-left: auto; display: flex; gap: 1rem; font-size: .9rem; color: var(--muted); align-items: center; }
.toggles button { padding: .35rem .6rem; border: 1px solid var(--rule); border-radius: .35rem; background: #1a1a1a; color: var(--fg); cursor: pointer; }
.page-hud { display: inline-flex; gap: .35rem; align-items: center; margin-left: 1rem; }
.page-hud input { width: 3.2rem; padding: .25rem .35rem; border: 1px solid var(--rule); border-radius: .3rem; background:#151515; color: var(--fg); text-align: center; }
.page-hud button { padding: .2rem .4rem; border: 1px solid var(--rule); border-radius: .3rem; background: #1a1a1a; color: var(--fg); cursor: pointer; }

.file-picker input[type="file"] { display: none; }
.file-picker span {
  display: inline-block; padding: .45rem .7rem; border: 1px solid var(--rule);
  border-radius: .4rem; background: #151515; cursor: pointer; color: var(--fg);
}
#srcInput { width: 22rem; max-width: 50vw; padding: .45rem .6rem; border: 1px solid var(--rule); border-radius: .35rem; background:#151515; color: var(--fg); }
#loadBtn { padding: .45rem .7rem; border: 1px solid var(--rule); border-radius: .35rem; background: #1a1a1a; color: var(--fg); cursor: pointer; }

#viewer { display: block; padding: 1.25rem; }
.work { display: block; margin: 0 auto; max-width: var(--content-width); }
.wide .work { max-width: 80rem; }

.content { display: block; }
.content h1, .content h2, .content h3 { line-height: 1.2; margin: 1.2em 0 .5em; }
.content p { margin: .7em 0; }
.content figure { margin: 1em auto; text-align: center; }

/* Page break markers */
.content .pb { display: inline-block; position: relative; margin: 1.2rem 0; padding: .15rem .5rem; border: 1px solid var(--rule); border-radius: .35rem; color: var(--muted); font-size: .8rem; }
.content .pb::before { content: attr(data-n); }
.hide-pb .content .pb { display: none; }

/* Two-column blocks (semantic wrapper converted from inline CSS) */
.content .columns { column-gap: 2rem; margin: 1rem 0; }
.content .columns[data-cols="2"] { column-count: 2; }
.content .columns[data-cols="3"] { column-count: 3; }
.content .columns { width: 100%; column-fill: balance; }
.no-cols .content .columns { column-count: 1 !important; }

/* Footnotes block */
.content section.footnotes { margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--rule); font-size: .9rem; color: var(--muted); }
.content section.footnotes ol { padding-left: 1.1rem; }
.content a.fn-ref { text-decoration: none; vertical-align: super; font-size: .75em; color: var(--accent); }

.status { position: sticky; bottom: 0; padding: .4rem .9rem; font-size: .85rem; background: #0c0c0c; border-top: 1px solid var(--rule); color: var(--muted); }
.current-section { max-width: 28rem; display: inline-block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--fg); opacity: .9; }

/* TOC panel */
.toc { position: fixed; top: 3.2rem; bottom: 2rem; left: .6rem; width: 16rem; overflow: auto; padding: .5rem .5rem .5rem .75rem; border-right: 1px solid var(--rule); background: rgba(12,12,12,.8); backdrop-filter: blur(2px); display: none; }
html.toc-open .toc { display: block; }
.toc a { display: block; color: var(--muted); text-decoration: none; padding: .15rem .2rem; border-radius: .25rem; }
.toc a:hover { background: #1a1a1a; color: var(--fg); }
.toc a.active { color: var(--accent); }
.toc .lvl-1 { margin-left: 0; font-weight: 600; }
.toc .lvl-2 { margin-left: .8rem; }
.toc .lvl-3 { margin-left: 1.6rem; }

/* Shift content when TOC visible in wide mode */
html.toc-open #viewer { margin-left: 17.5rem; }

/* Help overlay */
#helpOverlay { position: fixed; inset: 0; background: rgba(0,0,0,.65); display: none; align-items: center; justify-content: center; z-index: 1000; }
#helpOverlay .panel { max-width: 42rem; width: 90vw; background: #111; border: 1px solid var(--rule); border-radius: .5rem; padding: 1rem 1.25rem; box-shadow: 0 10px 30px rgba(0,0,0,.5); }
#helpOverlay h2 { margin: 0 0 .5rem; font-size: 1.1rem; }
#helpOverlay ul { margin: .25rem 0; padding-left: 1.1rem; }
#helpOverlay li { margin: .15rem 0; color: var(--muted); }
#helpOverlay kbd { background: #1a1a1a; border: 1px solid var(--rule); border-bottom-width: 2px; border-radius: .3rem; padding: .05rem .35rem; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color: var(--fg); }

/* Footnotes side panel */
.notes-panel { position: fixed; top: 3.2rem; right: .6rem; bottom: 2rem; width: 22rem; max-width: calc(100vw - 2rem); background: rgba(12,12,12,.92); backdrop-filter: blur(2px); border-left: 1px solid var(--rule); border-right: 1px solid var(--rule); border-radius: .4rem; display: none; flex-direction: column; z-index: 900; }
html.notes-open .notes-panel { display: flex; }
.notes-panel .hdr { display: flex; align-items: center; justify-content: space-between; gap: .5rem; padding: .6rem .7rem; border-bottom: 1px solid var(--rule); }
.notes-panel .hdr button { padding: .25rem .45rem; border: 1px solid var(--rule); border-radius: .3rem; background: #1a1a1a; color: var(--fg); cursor: pointer; }
.notes-panel .note-body { padding: .6rem .8rem; overflow: auto; flex: 1; }
.notes-panel .note-actions { padding: .5rem .7rem; border-top: 1px solid var(--rule); display: flex; justify-content: flex-end; }
.notes-panel .note-actions button { padding: .35rem .6rem; border: 1px solid var(--rule); border-radius: .35rem; background: #1a1a1a; color: var(--fg); cursor: pointer; }

html.notes-open #viewer { margin-right: 23rem; }
#viewer { display: block; padding: 1.25rem; transition: margin-left .2s ease; }

/* Inline notes (when enabled) */
.inline-note { display: inline-block; vertical-align: top; margin-left: .35rem; padding: .3rem .45rem; border: 1px solid var(--rule); border-radius: .35rem; background: #1a1a1a; color: var(--fg); max-width: 22rem; }
.inline-note .close { margin-left: .4rem; padding: .05rem .35rem; border: 1px solid var(--rule); border-radius: .25rem; background: #141414; color: var(--muted); cursor: pointer; }
